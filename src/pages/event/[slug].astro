---
import { getCollection, type CollectionEntry } from "astro:content";
import Main from "@/components/html-structure/Main.astro";
import Layout from "@/layouts/Layout.astro";
import { Image } from "astro:assets";
import { HomeIcon, DevicePhoneMobileIcon, AtSymbolIcon, TicketIcon } from "@heroicons/vue/24/outline";

export const getStaticPaths = async () => {
  const eventEntries = await getCollection("event");
  const paths = eventEntries.map((eventEntry) => ({
    params: { slug: eventEntry.slug },
    props: { event: eventEntry },
  }));
  return paths;
};

type Props = {
  event: CollectionEntry<"event">;
};

const { event } = Astro.props;

const { Content } = await event.render();

// Format the date as UTC
const eventDate = new Date(event.data.date + 'T00:00:00Z');
const formattedDate = eventDate.toLocaleDateString('en-US', {
  timeZone: 'UTC',
  weekday: 'long',
  month: 'short',
  day: '2-digit'
});


// const formattedDate = event.data.date ? format(new Date(event.data.date), "MMMM do, yyyy") : "";

function isValidUrl(urlString: string) {
  try {
    new URL(urlString);
    return true;
  } catch (error) {
    return false;
  }
}
---

<Layout title={`${event.data.title} | Event`}>
  <Main>

    <div class="pt-6">
      <nav aria-label="Breadcrumb" class="py-4">
        <ol role="list" class="flex items-center space-x-4">
          <li>
            <div class="flex items-center">
              <a href="/" class="text-gray-400 hover:text-gray-500">
                <HomeIcon class="h-4 w-4 flex-shrink-0 mr-4 text-sm font-medium text-gray-900" aria-hidden="true" />
                <span class="sr-only">Home</span>
              </a>

              <svg viewBox="0 0 6 20" aria-hidden="true" class="h-5 w-auto text-gray-300">
                <path d="M4.878 4.34H3.551L.27 16.532h1.327l3.281-12.19z" fill="currentColor"></path>
              </svg>
            </div>
          </li>
          <li>
            <div class="flex items-center">
              <a href="/event" class="mr-4 text-sm font-medium text-gray-900">Events</a>
              <svg viewBox="0 0 6 20" aria-hidden="true" class="h-5 w-auto text-gray-300">
                <path d="M4.878 4.34H3.551L.27 16.532h1.327l3.281-12.19z" fill="currentColor"></path>
              </svg>
            </div>
          </li>

          <li class="text-sm font-medium text-gray-500">
            {event.data.title}
          </li>
        </ol>
      </nav>
      <div class="lg:grid lg:auto-rows-min lg:grid-cols-12 lg:gap-x-8">
        <div class="lg:col-span-5 lg:col-start-8">
          <div class="flex justify-between">
            <h1 class="text-3xl font-bold text-gray-900">
              {event.data.title}
            </h1>
            <p class="text-xl font-medium text-gray-900">
              {event.data.price}
            </p>
          </div>


          <p class="text-lg text-gray-600">
            {formattedDate} at {event.data.time}
          </p>

          <div class="mt-10 flex items-center gap-x-6">
            {event.data.trailer && isValidUrl(event.data.trailer) && (
              <a href={event.data.trailer} class="text-base font-semibold leading-7 text-purple-600 hover:underline">Watch Trailer</a>
            )}
          </div>

          <div class="mt-6 flex gap-x-6">
            <div class="flex">
              <div class="flex flex-col">
                <p class="text-xs font-bold text-gray-900 uppercase">Event</p>
                { event.data.concertSponsor?.map((sponsor: string) => (
                    <span class="text-sm font-medium text-gray-400">{sponsor}</span>
                  ))
                }
              </div>
              <div aria-hidden="true" class="mx-4 text-sm text-gray-400">Â·</div>

            <div class="flex">
              <div class="flex flex-col">
                <p class="text-xs font-bold text-gray-900 uppercase">Reception</p>
                { event.data.receptionSponsor?.map((sponsor: string) => (
                    <span class="text-sm font-medium text-gray-400">{sponsor}</span>
                  ))
                }
              </div>
            </div>
          </div>

          <div class="mt-10 p-4 sm:p-6 items-start rounded-lg shadow-purple-400/30 shadow-2xl bg-white">
            <p class="font-semibold text-lg flex gap-1 items-center">
              <TicketIcon class="not-sr-only h-5 w-5" aria-hidden="true" />
              Tickets
            </p>
            <p class="">Purchase your tickets by phone or emailing.</p>

            <!-- horizontal line -->
            <div class="w-full h-px bg-gray-200 my-2 sm:my-6" style="opacity: 1; transform-origin: 50% 50% 0px;"></div>


            <div class="flex gap-1">
              <DevicePhoneMobileIcon class="mt-1 h-5 w-5 flex-none text-purple-600" aria-hidden="true" />
              <a href="tel:+17806731325" class="whitespace-nowrap text-sm leading-7 text-purple-600" aria-label="Call us at 780-374-2403">780-374-2403</a>
            </div>

            <div class="flex gap-1">
              <AtSymbolIcon class="mt-1 h-5 w-5 flex-none text-purple-600" aria-hidden="true" />
              <a href="mailto:info@daysarts.ca" class="whitespace-nowrap text-sm leading-7 text-purple-600" aria-label="Email us at info@daysarts.ca">info@daysarts.ca</a>
            </div>
          </div>

        </div>
        { event.data.poster && (
          <div class="mt-4 lg:col-span-7 lg:col-start-1 lg:row-span-3 lg:row-start-1 lg:mt-0">
            <div class="grid grid-cols-1 lg:grid-cols-2 lg:grid-rows-3 lg:gap-8 aspect-[3/4]">

              <Image
                src={event.data.poster}
                format="avif"
                quality="mid"
                width={1024}
                height={1024 * 1.5}
                alt={`${event.data.title} poster`}
                class="lg:col-span-2 lg:row-span-2 rounded-2xl object-cover bg-purple-100 h-full w-full shadow-purple-400/30 shadow-2xl"
              />
            </div>
          </div>
          )
        }

        <div class="mt-4 lg:col-span-5">
          <div class="mt-10">
            <!-- <h2 class="text-sm font-medium text-gray-900">Event details</h2> -->
            <div class="prose prose-l max-w-none mb-8">
              <p class="prose prose-xl">{ event.data.description }</p>
              <Content />
            </div>

          </div>

      </div>
    </div>

  </Main>
</Layout>
