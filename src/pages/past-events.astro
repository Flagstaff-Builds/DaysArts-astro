---
import Layout from "../layouts/Layout.astro";
import Main from "@components/html-structure/Main.astro";
import HeroSecondary from "@components/hero-secondary.astro";
import { FireIcon } from "@heroicons/vue/24/outline";
import { getCollection } from 'astro:content';

interface EventFrontmatter {
  title: string;
  date?: string;
  description?: string;
  slug: string;
}

type EventFile = {
  frontmatter: EventFrontmatter;
  file: string;
  url: string;
};

// Get all events from the collection
const allEvents = await getCollection('event');

// Filter and sort events
const sortedEvents = allEvents
  .filter(event => event.id.startsWith('_old/')) // Only get events from _old directory
  .sort((a, b) => 
    (b.data.date || '').localeCompare(a.data.date || '')
  );

---

<Layout title="Past events">
  <HeroSecondary
    tagline="Relive the Magic"
    title="Past shows"
    content="Explore the highlights of shows">
    <FireIcon slot="icon" class="h-10" />
  </HeroSecondary>

  <Main>
    <div class="mx-auto max-w-2xl space-y-16 sm:space-y-20 lg:mx-0 lg:max-w-none">
      <div class="mx-auto max-w-2xl lg:mx-0 lg:max-w-none">
        <div class="mt-8 space-y-16">
          <div>
            <dt class="text-lg font-bold leading-7 text-gray-900">Recent Past Shows</dt>
            <dd class="mt-2 text-base leading-7 text-gray-600">
              {sortedEvents.map((event, index) => (
                <span>
                  <a href={`/event/${event.slug}`} class="text-primary-600 hover:text-primary-500">
                    {event.data.title}
                  </a>
                  {index < sortedEvents.length - 1 ? ', ' : ''}
                </span>
              ))}
            </dd>
          </div>
        </div>
      </div>
    </div>
  </Main>
</Layout>