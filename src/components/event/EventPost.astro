---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { CalendarDaysIcon, ClockIcon } from '@heroicons/vue/24/outline';

interface Props {
  event: CollectionEntry<'event'>;
  index: number;
}

const { event, index }: Props = Astro.props;

// Pre-format the date at build time
const eventDate = new Date(event.data.date + 'T00:00:00-07:00'); // Use local timezone
const formattedDate = new Intl.DateTimeFormat('en-US', {
  weekday: 'long',
  month: 'short',
  day: '2-digit'
}).format(eventDate);

// Simplified eager loading for first item only
const isFirstItem = index === 0;

---

{!event.data.past && (
<li>
  <a href={`/event/${event.slug}`} class="block text-zinc-900">
    {event.data.poster && (
      <Image
        src={event.data.poster}
        format="webp"
        quality={isFirstItem ? "high" : "medium"}
        widths={[240, 540]}
        sizes="(max-width: 640px) 240px, 540px"
        alt={`${event.data.title} thumbnail`}
        class="aspect-[2/3] w-full rounded-xl bg-purple-100 object-cover shadow-purple-400/30 shadow-lg"
        loading={isFirstItem ? "eager" : "lazy"}
        decoding={isFirstItem ? "sync" : "async"}
      />
    )}
    <h3 class="mt-6 text-xl font-semibold leading-8 text-gray-900">{event.data.title}</h3>
    <p class="flex items-center text-base leading-7 text-gray-700">
      <CalendarDaysIcon class="mr-1 h-4 w-4 text-purple-600" aria-hidden="true" /> {formattedDate}
    </p>
    <p class="flex items-center text-base leading-7 text-gray-700">
      <ClockIcon class="mr-1 h-4 w-4 text-purple-600" aria-hidden="true" /> {event.data.time}
    </p>

    <div class="mt-4">
      <h2 class="text-sm font-bold text-gray-500 uppercase">Sponsors:</h2>
      <ul class="">
        {event.data.concertSponsor && event.data.concertSponsor.length > 0 && (
          <li>
            <span class="text-xs font-medium uppercase text-slate-500">Concert</span>
            <span aria-hidden="true" class="mx-4 text-sm text-gray-400">Â·</span>
            <span class="text-sm font-medium text-gray-400">{event.data.concertSponsor.join(', ')}</span>
          </li>
        )}
      </ul>
    </div>
  </a>
</li>
)}